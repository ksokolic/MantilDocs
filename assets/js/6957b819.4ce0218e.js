"use strict";(self.webpackChunkmantil_docs=self.webpackChunkmantil_docs||[]).push([[2723],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return d}});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var m=i.createContext({}),c=function(e){var t=i.useContext(m),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=c(e.components);return i.createElement(m.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,m=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(n),d=o,h=u["".concat(m,".").concat(d)]||u[d]||p[d]||a;return n?i.createElement(h,r(r({ref:t},s),{},{components:n})):i.createElement(h,r({ref:t},s))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=u;var l={};for(var m in t)hasOwnProperty.call(t,m)&&(l[m]=t[m]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var c=2;c<a;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1268:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return m},default:function(){return d},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return p}});var i=n(7462),o=n(3366),a=(n(7294),n(3905)),r=["components"],l={},m="API Configuration",c={unversionedId:"api_configuration",id:"api_configuration",title:"API Configuration",description:"Environment Variables",source:"@site/docs/api_configuration.md",sourceDirName:".",slug:"/api_configuration",permalink:"/MantilDocs/docs/api_configuration",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api_configuration.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Anonymous Analytics",permalink:"/MantilDocs/docs/analytics"},next:{title:"Detailed AWS Setup",permalink:"/MantilDocs/docs/aws_install"}},s={},p=[{value:"Environment Variables",id:"environment-variables",level:2},{value:"Scheduled execution",id:"scheduled-execution",level:2},{value:"Private APIs",id:"private-apis",level:2},{value:"Custom domain names",id:"custom-domain-names",level:2}],u={toc:p};function d(e){var t=e.components,n=(0,o.Z)(e,r);return(0,a.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"api-configuration"},"API Configuration"),(0,a.kt)("h2",{id:"environment-variables"},"Environment Variables"),(0,a.kt)("p",null,"APIs come preconfigured with default settings for memory size, timeout and environment variables. You can customize these settings using the ",(0,a.kt)("inlineCode",{parentName:"p"},"config/environment.yml")," file. Values can be defined on a project, stage or function level. If the same value is defined on multiple levels, the lowest level will take precedence. The final values will be visible in ",(0,a.kt)("inlineCode",{parentName:"p"},"config/state.yml")," after deployment."),(0,a.kt)("p",null,"For example, let's say we created a project with two functions called ",(0,a.kt)("inlineCode",{parentName:"p"},"one")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"two")," and deployed it to two stages called ",(0,a.kt)("inlineCode",{parentName:"p"},"development")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"production"),". After creating both stages, the ",(0,a.kt)("inlineCode",{parentName:"p"},"config/state.yml")," file will look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"name: my-project\nstages:\n- name: development\n  ...\n  functions:\n  - name: one\n    ...\n    memory_size: 128\n    timeout: 900\n    env:\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoiZGV2ZWxvcG1lbnQiLCJNQU5USUxfV09SS1NQQUNFIjoiN2Vub2o1TjVRby0yZVNwQkhWVEJlQSJ9LCJXc0ZvcndhcmRlck5hbWUiOiJtYW50aWwtbXktcHJvamVjdC1kZXZlbG9wbWVudC13cy1mb3J3YXJkZXItYzVjNjM2ZTAiLCJOYW1pbmdUZW1wbGF0ZSI6Im15LXByb2plY3QtZGV2ZWxvcG1lbnQtJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: development\n  - name: two\n    ...\n    memory_size: 128\n    timeout: 900\n    env:\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoiZGV2ZWxvcG1lbnQiLCJNQU5USUxfV09SS1NQQUNFIjoiN2Vub2o1TjVRby0yZVNwQkhWVEJlQSJ9LCJXc0ZvcndhcmRlck5hbWUiOiJtYW50aWwtbXktcHJvamVjdC1kZXZlbG9wbWVudC13cy1mb3J3YXJkZXItYzVjNjM2ZTAiLCJOYW1pbmdUZW1wbGF0ZSI6Im15LXByb2plY3QtZGV2ZWxvcG1lbnQtJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: development\n- name: production\n  ...\n  functions:\n  - name: one\n    ...\n    memory_size: 128\n    timeout: 900\n    env:\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoicHJvZHVjdGlvbiIsIk1BTlRJTF9XT1JLU1BBQ0UiOiI3ZW5vajVONVFvLTJlU3BCSFZUQmVBIn0sIldzRm9yd2FyZGVyTmFtZSI6Im1hbnRpbC1teS1wcm9qZWN0LXByb2R1Y3Rpb24td3MtZm9yd2FyZGVyLWM1YzYzNmUwIiwiTmFtaW5nVGVtcGxhdGUiOiJteS1wcm9qZWN0LXByb2R1Y3Rpb24tJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: production\n  - name: two\n    ...\n    memory_size: 128\n    timeout: 900\n    env:\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoicHJvZHVjdGlvbiIsIk1BTlRJTF9XT1JLU1BBQ0UiOiI3ZW5vajVONVFvLTJlU3BCSFZUQmVBIn0sIldzRm9yd2FyZGVyTmFtZSI6Im1hbnRpbC1teS1wcm9qZWN0LXByb2R1Y3Rpb24td3MtZm9yd2FyZGVyLWM1YzYzNmUwIiwiTmFtaW5nVGVtcGxhdGUiOiJteS1wcm9qZWN0LXByb2R1Y3Rpb24tJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: production\n")),(0,a.kt)("p",null,"Since we have not yet defined any custom values in ",(0,a.kt)("inlineCode",{parentName:"p"},"config/environment.yml")," all values will be set to their defaults. Note that Mantil also sets some default environment variables, always starting with ",(0,a.kt)("inlineCode",{parentName:"p"},"MANTIL_"),". So now we can define some custom values:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"project:\n  memory_size: 128\n  timeout: 30\n  env:\n    KEY: project\n  stages: \n    - name: development\n      functions:\n      - name: one\n        memory_size: 256\n        timeout: 60\n        private: true\n        env:\n          KEY: function\n    - name: production\n      memory_size: 512\n      timeout: 120\n      env:\n        KEY: stage\n")),(0,a.kt)("p",null,"After deploying both stages again the final state will look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"name: my-project\nstages:\n- name: development\n  ...\n  functions:\n  - name: one\n    ...\n    memory_size: 256\n    timeout: 60\n    private: true\n    env:\n      KEY: function\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoiZGV2ZWxvcG1lbnQiLCJNQU5USUxfV09SS1NQQUNFIjoiN2Vub2o1TjVRby0yZVNwQkhWVEJlQSJ9LCJXc0ZvcndhcmRlck5hbWUiOiJtYW50aWwtbXktcHJvamVjdC1kZXZlbG9wbWVudC13cy1mb3J3YXJkZXItYzVjNjM2ZTAiLCJOYW1pbmdUZW1wbGF0ZSI6Im15LXByb2plY3QtZGV2ZWxvcG1lbnQtJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: development\n  - name: two\n    ...\n    memory_size: 128\n    timeout: 30\n    env:\n      KEY: project\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoiZGV2ZWxvcG1lbnQiLCJNQU5USUxfV09SS1NQQUNFIjoiN2Vub2o1TjVRby0yZVNwQkhWVEJlQSJ9LCJXc0ZvcndhcmRlck5hbWUiOiJtYW50aWwtbXktcHJvamVjdC1kZXZlbG9wbWVudC13cy1mb3J3YXJkZXItYzVjNjM2ZTAiLCJOYW1pbmdUZW1wbGF0ZSI6Im15LXByb2plY3QtZGV2ZWxvcG1lbnQtJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: development\n- name: production\n  ...\n  functions:\n  - name: one\n    ...\n    memory_size: 512\n    timeout: 120\n    env:\n      KEY: stage\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoicHJvZHVjdGlvbiIsIk1BTlRJTF9XT1JLU1BBQ0UiOiI3ZW5vajVONVFvLTJlU3BCSFZUQmVBIn0sIldzRm9yd2FyZGVyTmFtZSI6Im1hbnRpbC1teS1wcm9qZWN0LXByb2R1Y3Rpb24td3MtZm9yd2FyZGVyLWM1YzYzNmUwIiwiTmFtaW5nVGVtcGxhdGUiOiJteS1wcm9qZWN0LXByb2R1Y3Rpb24tJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: production\n  - name: two\n    ...\n    memory_size: 512\n    timeout: 120\n    env:\n      KEY: stage\n      MANTIL_GO_CONFIG: eyJSZXNvdXJjZVRhZ3MiOnsiTUFOVElMX0tFWSI6ImM1YzYzNmUwIiwiTUFOVElMX1BST0pFQ1QiOiJteS1wcm9qZWN0IiwiTUFOVElMX1NUQUdFIjoicHJvZHVjdGlvbiIsIk1BTlRJTF9XT1JLU1BBQ0UiOiI3ZW5vajVONVFvLTJlU3BCSFZUQmVBIn0sIldzRm9yd2FyZGVyTmFtZSI6Im1hbnRpbC1teS1wcm9qZWN0LXByb2R1Y3Rpb24td3MtZm9yd2FyZGVyLWM1YzYzNmUwIiwiTmFtaW5nVGVtcGxhdGUiOiJteS1wcm9qZWN0LXByb2R1Y3Rpb24tJXMtYzVjNjM2ZTAifQ==\n      MANTIL_KEY: c5c636e0\n      MANTIL_PROJECT: my-project\n      MANTIL_STAGE: production\n")),(0,a.kt)("p",{align:"right"}," ",(0,a.kt)("a",{href:"https://github.com/mantil-io/mantil/tree/master/docs#mantil-documentation"},"\u21b5 Back to Documentation Home!")),(0,a.kt)("h1",{id:""}),(0,a.kt)("h2",{id:"scheduled-execution"},"Scheduled execution"),(0,a.kt)("p",null,"Using the ",(0,a.kt)("inlineCode",{parentName:"p"},"cron")," field, you can set up a rule to execute an API on a schedule. For example, with the following setup, the default method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"one")," API will be executed every minute:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'project:\n  stages: \n    - name: development\n      functions:\n      - name: one\n        cron: "* * * * ? *"\n        env:\n          KEY: function\n')),(0,a.kt)("p",null,"For more information about the cron syntax, please refer to the AWS docs:\n",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/RunLambdaSchedule.html"},"https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/RunLambdaSchedule.html")),(0,a.kt)("p",{align:"right"}," ",(0,a.kt)("a",{href:"https://github.com/mantil-io/mantil/tree/master/docs#mantil-documentation"},"\u21b5 Back to Documentation Home!")),(0,a.kt)("h1",{id:"-1"}),(0,a.kt)("h2",{id:"private-apis"},"Private APIs"),(0,a.kt)("p",null,"Using the ",(0,a.kt)("inlineCode",{parentName:"p"},"private")," field, you can set your functions as private, which will require additional authorization to execute methods through API. Private and public keys are generated when creating a new stage which are then used to generate JWT on each request. This token is verified through the authorizer Lambda function. Token generation is done automatically if you're using the ",(0,a.kt)("inlineCode",{parentName:"p"},"invoke")," command."),(0,a.kt)("p",{align:"right"}," ",(0,a.kt)("a",{href:"https://github.com/mantil-io/mantil/tree/master/docs#mantil-documentation"},"\u21b5 Back to Documentation Home!")),(0,a.kt)("h1",{id:"-2"}),(0,a.kt)("h2",{id:"custom-domain-names"},"Custom domain names"),(0,a.kt)("p",null,"Custom domain names are simpler and more intuitive URLs that you can provide to your API users. By default, you can access APIs through the default API gateway URLs, which are generated for each stage and have the following format:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"https://<http-api-id>.execute-api.<region>.amazonaws.com/<api_name>/<method_name>\n")),(0,a.kt)("p",null,"and"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"wss://<ws-api-id>.execute-api.<region>.amazonaws.com/$default\n")),(0,a.kt)("p",null,"In order to set up a custom domain for your stage, you need the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"a Route 53 public hosted zone"),(0,a.kt)("li",{parentName:"ul"},"a registered domain configured to use the name servers of that hosted zone. The easiest way to achieve this is by registering the domain with Route 53. This will automatically create a hosted zone."),(0,a.kt)("li",{parentName:"ul"},"a certificate covering all the subdomains that will be created")),(0,a.kt)("p",null,"Then you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"custom_domain")," field in the stage config to set up the domain. It accepts the following arguments:\n",(0,a.kt)("inlineCode",{parentName:"p"},"domain_name")," - (Required) The registered domain name.\n",(0,a.kt)("inlineCode",{parentName:"p"},"http_subdomain")," - (Optional) The subdomain to use for HTTP APIs. Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"api"),".\n",(0,a.kt)("inlineCode",{parentName:"p"},"ws_subdomain")," - (Optional) The subdomain to use for WebSocket APIs. Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"ws"),".\n",(0,a.kt)("inlineCode",{parentName:"p"},"cert_domain")," - (Optional) The domain name of the certificate. Defaults to the value of the ",(0,a.kt)("inlineCode",{parentName:"p"},"domain_name")," parameter.\n",(0,a.kt)("inlineCode",{parentName:"p"},"hosted_zone_domain")," - (Optional) The domain name of the hosted zone. Defaults to the value of the ",(0,a.kt)("inlineCode",{parentName:"p"},"domain_name")," parameter."),(0,a.kt)("p",null,"For example, the simplest setup for the domain ",(0,a.kt)("inlineCode",{parentName:"p"},"example.com")," would look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"project:\n  stages: \n    - name: production\n      custom_domain:\n        domain_name: example.com\n")),(0,a.kt)("p",null,"After deploying this stage it will have the following endpoints:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"https://api.example.com\n")),(0,a.kt)("p",null,"and"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"wss://ws.example.com\n")),(0,a.kt)("p",{align:"right"}," ",(0,a.kt)("a",{href:"https://github.com/mantil-io/mantil/tree/master/docs#mantil-documentation"},"\u21b5 Back to Documentation Home!")))}d.isMDXComponent=!0}}]);