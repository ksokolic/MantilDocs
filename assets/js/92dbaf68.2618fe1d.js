"use strict";(self.webpackChunkmantil_docs=self.webpackChunkmantil_docs||[]).push([[417],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return n?a.createElement(f,i(i({ref:t},c),{},{components:n})):a.createElement(f,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4189:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={},s="General Concepts",p={unversionedId:"general_concepts",id:"general_concepts",title:"General Concepts",description:"Two probably new concepts in Mantil are node and stage. So let's first familiarize yourself with them.",source:"@site/docs/general_concepts.md",sourceDirName:".",slug:"/general_concepts",permalink:"/MantilDocs/general_concepts",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"FAQ",permalink:"/MantilDocs/faq"},next:{title:"getting_started",permalink:"/MantilDocs/getting_started"}},c={},u=[{value:"Node",id:"node",level:2},{value:"Stage",id:"stage",level:2},{value:"Stage endpoint",id:"stage-endpoint",level:3},{value:"Project Structure",id:"project-structure",level:2},{value:"API",id:"api",level:3},{value:"Public folder",id:"public-folder",level:3},{value:"Build folder",id:"build-folder",level:3},{value:"Config folder",id:"config-folder",level:3},{value:"Test",id:"test",level:3}],d={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"general-concepts"},"General Concepts"),(0,r.kt)("p",null,"Two probably new concepts in Mantil are node and stage. So let's first familiarize yourself with them."),(0,r.kt)("h2",{id:"node"},"Node"),(0,r.kt)("p",null,"Mantil consists of two main components, node and CLI. CLI is mantil binary you\n",(0,r.kt)("a",{parentName:"p",href:"/MantilDocs/cli_install"},"install")," on your local machine.\nNode is located in AWS. Node is set of functions used for managing Mantil\nprojects. First, you use CLI to ",(0,r.kt)("a",{parentName:"p",href:"/MantilDocs/aws_install"},"install a node into your AWS account"),". After that, CLI issues commands, and the node executes them in the cloud."),(0,r.kt)("p",null,"Node is installed into a region of an AWS account. You can have multiple nodes\nin the same or different AWS accounts. When you are setting project stage you\nchoose a node for that stage."),(0,r.kt)("h2",{id:"stage"},"Stage"),(0,r.kt)("p",null,"The stage is an installation of a project into the cloud. Before creating stage, the project is\njust a set of files. Once you create a stage that builds Lambda functions from your\napi's, API Gateway for that functions and other supporting resources. With that\nproject gets a live endpoint where you can execute your api's."),(0,r.kt)("p",null,"The stage is located on a node. While creating stage ",(0,r.kt)("inlineCode",{parentName:"p"},"mantil stage\nnew")," you specify node for the stage. You can\nhave multiple stages of the project. Each can be located on a different node."),(0,r.kt)("p",null,"While working in the project, there is a notion of default stage. One stage is always\ndefault, so it is the target of all other project commands. So, for example, when you\ndeploy/test/watch logs..., you execute those commands on the default stage.\nTo see all the stages and see which one is default there is ",(0,r.kt)("inlineCode",{parentName:"p"},"mantil stage\nls")," command, and to change default ",(0,r.kt)("inlineCode",{parentName:"p"},"mantil\nstage use"),"."),(0,r.kt)("h3",{id:"stage-endpoint"},"Stage endpoint"),(0,r.kt)("p",null,"When created each stage gets two endpoints: HTTP and WebSocket. Endpoint is URL\nwhere stage API's are exposed. "),(0,r.kt)("p",null,"HTTP endpoint will be something like:\n",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com"},"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com")),", and WebSocket:\n_",(0,r.kt)("em",{parentName:"p"},"wss://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com"),"."),(0,r.kt)("h2",{id:"project-structure"},"Project Structure"),(0,r.kt)("p",null,"The project is a set of files on the disk and, of course, in a version control system.\nYou are creating new project with ",(0,r.kt)("inlineCode",{parentName:"p"},"mantil new"),".\nThat creates project structure and nothing more. Until you create a project\nstage project don't have anything but files on the disk."),(0,r.kt)("p",null,"In Mantil we choose to favor convention over configuration. A big part of that\nconvention is in the Mantil project structure. Let's look into an example Mantil\nproject with two API's: ping and second."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 api\n\u2502\xa0\xa0 \u251c\u2500\u2500 ping\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ping.go\n\u2502   \u2502   \u2514\u2500\u2500 ping_test.go\n\u2502\xa0\xa0 \u2514\u2500\u2500 second\n\u2502\xa0\xa0     \u2514\u2500\u2500 second.go\n\u251c\u2500\u2500 build\n\u2502\xa0\xa0 \u2514\u2500\u2500 functions\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 ping\n|       |   \u251c\u2500\u2500 main.go\n|       |   \u2514\u2500\u2500 bootstrap\n\u2502\xa0\xa0     \u2514\u2500\u2500 second\n|           \u251c\u2500\u2500 main.go\n|           \u2514\u2500\u2500 bootstrap\n\u251c\u2500\u2500 config\n\u2502\xa0\xa0 \u251c\u2500\u2500 environment.yml\n\u2502\xa0\xa0 \u2514\u2500\u2500 state.yml\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 public\n\u2502\xa0\xa0 \u251c\u2500\u2500 api.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 index.html\n\u2502\xa0\xa0 \u2514\u2500\u2500 style.css\n\u2514\u2500\u2500 test\n    \u251c\u2500\u2500 init.go\n    \u251c\u2500\u2500 ping_test.go\n    \u2514\u2500\u2500 second_test.go\n")),(0,r.kt)("h3",{id:"api"},"API"),(0,r.kt)("p",null,"API folder is a set of Go packages where each package after deployment will become\nexposed on the endpoint URL."),(0,r.kt)("p",null,"The package needs to have exported _",(0,r.kt)("em",{parentName:"p"},"New")," method, which returns a pointer to the\nstruct. That struct will be exposed at ",(0,r.kt)("em",{parentName:"p"},"endpoint/package-name")," URL. Where\nendpoint is stage endpoint URL."),(0,r.kt)("p",null,"The package named ping from the example will be exposed at ",(0,r.kt)("em",{parentName:"p"},"endpoint/ping"),". All\nexported packages methods will be exposed at ",(0,r.kt)("em",{parentName:"p"},"endpoint/ping/method-name"),". If the\npackage has the method named ",(0,r.kt)("em",{parentName:"p"},"Default"),", that method is mapped to the package root\n",(0,r.kt)("em",{parentName:"p"},"endpoint/ping"),". For example if the stage HTTP endpoint is\n",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com"},"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com"))," URLs of the package\nping methods will be:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"URL"),(0,r.kt)("th",{parentName:"tr",align:null},"Go method in ping.Ping struct"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com/ping"},"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com/ping")),(0,r.kt)("td",{parentName:"tr",align:null},"Default")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com/ping/hello"},"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com/ping/hello")),(0,r.kt)("td",{parentName:"tr",align:null},"Hello")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com/ping/reqrsp"},"https://lh5rfrc3gf.execute-api.eu-central-1.amazonaws.com/ping/reqrsp")),(0,r.kt)("td",{parentName:"tr",align:null},"ReqRsp")))),(0,r.kt)("p",null,"The method needs to have a specific signature to be used by Mantil in API URLs. Method\nneeds to be exported and must follow these rules:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"may take between 0 and two arguments."),(0,r.kt)("li",{parentName:"ul"},'if there are two arguments, the first argument must satisfy the "context.Context" interface.'),(0,r.kt)("li",{parentName:"ul"},"may return between 0 and two arguments."),(0,r.kt)("li",{parentName:"ul"},"if there are two return values, the second argument must be an error."),(0,r.kt)("li",{parentName:"ul"},"if there is one return value, it must be an error.")),(0,r.kt)("p",null,"valid signatures are:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"   func ()\n   func () error\n   func (TIn) error\n   func () (TOut, error)\n   func (context.Context) error\n   func (context.Context, TIn) error\n   func (context.Context) (TOut, error)\n   func (context.Context, TIn) (TOut, error)\n")),(0,r.kt)("p",null,"The same as rules as for default AWS ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/lambda/latest/dg/golang-handler.html"},"Go\nhandler")," with\nthe added convention that each method in the API struct is exposed as a URL path."),(0,r.kt)("h3",{id:"public-folder"},"Public folder"),(0,r.kt)("p",null,"A public folder is a place for your static site content. Put an ",(0,r.kt)("em",{parentName:"p"},"index.html")," file in\nthe ",(0,r.kt)("em",{parentName:"p"},"/public")," folder, and it will be visible at the endpoint root."),(0,r.kt)("h3",{id:"build-folder"},"Build folder"),(0,r.kt)("p",null,"The build folder is automatically generated on each deploy and contains the main package\nfor each API which is code that transforms your API's to Lambda functions.\nBinaries of your functions named ",(0,r.kt)("em",{parentName:"p"},"bootstrap")," are also placed in this folder. If\nyou're using source control, this folder should be untracked by adding it to your\n",(0,r.kt)("em",{parentName:"p"},".gitignore")," file since all data is generated on each deploy. This is\nautomatically done for you when initializing project with ",(0,r.kt)("em",{parentName:"p"},"new")," command."),(0,r.kt)("p",null,"Code in build folder uses ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mantil-io/mantil.go"},"Mantil Go\nSDK")," to transform your API's to AWS\nLambda functions."),(0,r.kt)("h3",{id:"config-folder"},"Config folder"),(0,r.kt)("p",null,"In config folder ",(0,r.kt)("em",{parentName:"p"},"environment.yml")," is a place where you can set environment\nvariables for each Stage. So you can configure different behavior in different\nstages.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("em",{parentName:"p"},"state.yml")," is a project database file maintained by Mantil. It is stored in the project\nso you can see the history of all changes. You should not edit this file."),(0,r.kt)("h3",{id:"test"},"Test"),(0,r.kt)("p",null,"Test folder if where your API end to end tests are stored. Explore\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mantil-io/template-ping/blob/master/test/ping_test.go"},"ping"),"\nexample to get an idea of how to create requests and explore results. Read more about\n",(0,r.kt)("a",{parentName:"p",href:"/MantilDocs/Usage/testing"},"testing")," in Mantil."))}m.isMDXComponent=!0}}]);